<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro de usuario</title>
    <link rel="stylesheet" href="../static/regist.css">
</head>
<body>
    <form id="registroForm" action="{{ url_for('registro_post') }}" method="POST">
        <h2>Registro de usuario</h2>
        <h3>Completa tus datos</h3>
        <input type="text" name="nombre" placeholder="Nombre" required>
        <input type="text" name="apellido" placeholder="Apellido" required>
        <input type="email" name="mail" placeholder="Correo electrónico" required>
        <input type="text" name="legajo" placeholder="Legajo" required>
        <button type="submit">Registrarse</button>
        <button type="button" id="loginBtn">Iniciar sesión</button>
    </form>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul>{% for msg in messages %}
          <li>{{ msg }}</li>
        {% endfor %}</ul>
      {% endif %}
    {% endwith %}

    <script>
      const form = document.getElementById("registroForm");
      const inputs = form.querySelectorAll("input");
      const loginBtn = document.getElementById("loginBtn");

      let submitting = false;

      // Cargar datos guardados del localStorage
      window.addEventListener("load", () => {
        inputs.forEach(input => {
          const savedValue = localStorage.getItem(input.name);
          if (savedValue) input.value = savedValue;
        });
      });

      // Guardar en localStorage mientras escribe
      inputs.forEach(input => {
        input.addEventListener("input", () => {
          localStorage.setItem(input.name, input.value);
        });
      });

      // Pop-up si intenta salir con datos cargados
      window.addEventListener("beforeunload", (e) => {
        if (submitting) return;
        let hasData = false;
        inputs.forEach(input => {
          if (input.value.trim() !== "") hasData = true;
        });
        if (hasData) {
          e.preventDefault();
          e.returnValue = "Tienes datos sin guardar. ¿Seguro que quieres salir?";
        }
      });

      // Botón para ir a login
      loginBtn.addEventListener("click", () => {
        submitting = true;
        window.location.href = "{{ url_for('login') }}";
      });

      // Limpiar cache al enviar
      form.addEventListener("submit", () => {
        submitting = true;
        localStorage.clear();
      });
    </script>
</body>
</html>
